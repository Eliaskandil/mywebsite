<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numbers!</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
        }
        .alink{
            display: inline-block; 
            color: black; 
            background-color: #efefef; 
            outline:auto; 
            outline-color: black; 
            margin: 10px 10px; 
            padding: 10px 20px; 
            font-size: 1.2em; 
            position: absolute;
            top: 600px;
        }
        .input{
            font-size: 500%;
            width: 25%;
            height: 25%;
        }
    </style>
</head>
<body>
    <div id="spc" style="font-size: 300%;" class="tesxt">NUMBER SUBMISSIONS ARE OPEN!</div>
    <input id="input" maxlength="8"></input></div><input id="input2" maxlength="8"></input><input id="input3" maxlength="8"></input></div>
    <div id="spc" style="font-size: 200%;" class="tesxt">Write your submissions above for a chance of them to join the game!</div>
    <div><button style="background-color: #0022FF; color: #FFFFFF;" id="discrodB">Login using Discord</button><button style="background-color: #FFFFFF;" id="emialB">Login using email</button></div>
    <button style="font-size: 200%; background-color: green;color: #efefef;" onmousedown="submit1()" onmouseenter="enterm()" onmouseleave="leavem()" id="submition1">SUBMIT!!!</button>
    <div class="tesxt" ><h1>~~~Game Details~~~</h1>
    <p>There will be a pool of 50 submitted numbers which will be up for voting, each round some numbers will be eliminated from the game until one number remains</p>
    <p>The game will be split in two parts, submissions being the first part</p>
    <p>-- First Part: Submit your own numbers to have a chance of them being voted in future rounds</p>
    <p>-- Second Part: 50 chosen numbers will be up for voting, you get to vote the three numbers you like the most</p>
    <p>When each round ends, the numbers with the least votes get eliminated</p>
    <p style="bottom: 0%; padding: 0px;">The game ends when only one number is left, giving it an eternally nice reputation and crowning it the winner of the game!</p>
    <div style="font-size: 10%; margin-top: 0px; top: 0px; border-top: 0px; padding-top: 0px;">maybe next time you can submit any strings to be voted</div>
    </div>
    <div id="LoginUsingEmail" style="width: 50%; height: 50%; top:20%; left: 25%; background-color: #777777; position: absolute; border-color: #FFFFFF; border-radius: 20px; border-width: 2px; border-style: solid; display: none; opacity: 0;"><h1 id="logintext">Please enter your email:</h1> <input id="emailinp" style="font-size: x-large; height: 46px;"><button style="font-size: x-large;" id="loginB1">Login</button></div>

    <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.26.3/dist/pocketbase.umd.js"></script>
    <script>
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        const pb = new PocketBase('http://privx.duckdns.org:12520');
        let potato = 0
        let usre = 0
        const dcb = document.getElementById("discrodB")
        const emb = document.getElementById("emialB")
        const lgt = document.getElementById("logintext")
        const emp = document.getElementById("emailinp")
        const emaildial = document.getElementById("LoginUsingEmail")
        const loginB1 = document.getElementById("loginB1")
        pb.authStore.clear()
        requestAnimationFrame(loop)
        document.getElementById("input").className = "input"
        document.getElementById("input2").className = "input"
        document.getElementById("input3").className = "input"
        function loop() {
            {
                requestAnimationFrame(loop)
                for(let i=0;i<document.getElementsByClassName("input").length;i++){
                    document.getElementsByClassName("input")[i].style.fontSize = window.innerWidth/(Math.PI+0.5) + "%"
                    document.getElementsByClassName("input")[i].style.width = "20%"
                }
                if (potato == 1){
                    document.getElementById("submition1").style.backgroundColor = "green"
                    document.getElementById("submition1").style.fontSize = String(Number(document.getElementById("submition1").style.fontSize.substr(0,3)) + (185-Number(document.getElementById("submition1").style.fontSize.substr(0,3)))/5) + "%"
                }else if(potato == 0){
                    document.getElementById("submition1").style.backgroundColor = "#33EE33"
                    document.getElementById("submition1").style.fontSize = String(Number(document.getElementById("submition1").style.fontSize.substr(0,3)) + (200-Number(document.getElementById("submition1").style.fontSize.substr(0,3)))/5) + "%"
                }else{
                    document.getElementById("submition1").style.fontSize = String(Number(document.getElementById("submition1").style.fontSize.substr(0,3)) + (160-Number(document.getElementById("submition1").style.fontSize.substr(0,3)))/5) + "%"
                }
            }
            {
                let theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                if(theme){
                    document.body.style.backgroundColor = "black"
                    for(let i=0;i<document.getElementsByClassName("input").length;i++){
                        document.getElementsByClassName("input")[i].style.backgroundColor = "black"
                        document.getElementsByClassName("input")[i].style.borderColor = "white"
                        document.getElementsByClassName("input")[i].style.color = "white"
                    }
                    for(let i=0;i<document.getElementsByClassName("tesxt").length;i++){
                        document.getElementsByClassName("tesxt")[i].style.color = "white"
                    }
                    document.getElementById("emialB").style.backgroundColor = "white"
                    document.getElementById("emialB").style.color = "black"
                }else{
                    document.body.style.backgroundColor = "white"
                    for(let i=0;i<document.getElementsByClassName("input").length;i++){
                        document.getElementsByClassName("input")[i].style.backgroundColor = "white"
                        document.getElementsByClassName("input")[i].style.borderColor = "black"
                        document.getElementsByClassName("input")[i].style.color = "black"
                    }
                    for(let i=0;i<document.getElementsByClassName("tesxt").length;i++){
                        document.getElementsByClassName("tesxt")[i].style.color = "black"
                    }
                    document.getElementById("emialB").style.backgroundColor = "black"
                    document.getElementById("emialB").style.color = "white"
                }
            }
        }
        function submit1(){
            
            potato = 2
        }
        
        async function submit2(){
            potato = 1
            let mation = confirm("You sure these submissions are worthy enough of being voted?")
            if(mation){
                let text1 = Number(document.getElementById("input").value)
                let text2 = Number(document.getElementById("input2").value)
                let text3 = Number(document.getElementById("input3").value)
                if((text1)&&(text2)&&(text3)){
                    if(pb.authStore.isValid){
                        const numcol = pb.collection("numbers")
                        console.log(usre)
                        let emiail = usre.record.email
                        let rec = 0
                        let real = (emiail.trim()).split(".")
                        let real2 = ""
                        for(i=0;i<real.length;i++){
                            real2 += real[i]
                        }
                        console.log(real2)
                        try{rec = await numcol.getFirstListItem('email=' + '"' + real2 + '"')}catch(error){}
                        if(rec){
                            alert("HEYY YOU'VE ALREADY SUBMITTED NUMBERS >:(")
                        }else{
                            const recrod = await numcol.create({
                                number1: text1,
                                number2: text2,
                                number3: text3,
                                email: real2
                            })
                            alert("GGs, your submissions shall now be considered!")
                        }
                    }else{
                        alert("do you not see the login buttons?")
                    }
                    
                }else{
                    let nice = []
                    if(!text1){nice.push("1st")}
                    if(!text2){nice.push("2nd")}
                    if(!text3){nice.push("3rd")}
                    if (nice.length==1){
                        alert(`you cheeky boi, the ` + nice[0] + ` submission isn't a number!`)
                    }else{
                        let str = ""
                        for(let i=0;i<nice.length;i++){
                            if((i+1)==nice.length){str += "and " + nice[i]}else{str += nice[i] +", "}   
                        }
                        alert(`you cheeky boi, the ` + str + ` submissions aren't numbers!`)
                    }
                }
            }
        }
        function enterm(){
            potato = 1
        }
        function leavem(){
            potato = 0
        }
        function login(){
            dcb.style.display = 'none'
            emb.style.display = 'none'
        }
        async function dislin() {
            try{usre = await pb.collection('users').authWithOAuth2({ provider: 'discord' })}catch(error){}
            if(usre){
                login()
            }
        }
        async function mailin() {
            emaildial.style.display = "inline-block"
            for(let op=1;op<=25;op++){
                emaildial.style.opacity = op/25
                emaildial.style.top = (19 + (op/24)) + "%"
                await delay(1)
            }
        }
        let stage = true
        let result = 0
        async function email1(){
            const usress = pb.collection("users")
            if(stage){
                let ishelog = 0
                lgt.innerText = "..."
                emp.style.display = 'none'
                loginB1.style.display = 'none'
                try{await usress.getFirstListItem('email=' + '"' + emp.value + '"'); ishelog = 1}catch{}
                let pas2s = Math.random().toString(36).substring(2,12)
                try{const recuser = await usress.create({
                    'email': emp.value,
                    'password': pas2s,
                    'passwordConfirm': pas2s
                })}catch{}
                result = await usress.requestOTP(emp.value);
                emp.style.display = 'inline-block'
                loginB1.style.display = 'inline-block'
                lgt.innerText = "Please enter the OTP we sent to your email"
                stage=false
            }else{
                try{usre = await usress.authWithOTP(result.otpId, emp.value)}catch{alert("Something wrong went on (maybe you wrote the OTP wrong?)")}
                if(usre&&pb.authStore.isValid){
                    login()
                    emaildial.style.display = "none"
                }
            }
        }
        document.getElementById("submition1").addEventListener('click',submit2)
        dcb.addEventListener('click', dislin)
        emb.addEventListener('click',mailin)
        loginB1.addEventListener('click',email1)
    </script>

</body>
</html>
